<?xml version="1.0" encoding="iso-8859-1" standalone='no'?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 20001102//EN"
"http://www.w3.org/TR/2000/CR-SVG-20001102/DTD/svg-20001102.dtd">
<svg id="mainSvgDocument"  onload="load(evt);"  xmlns:xlink="http://www.w3.org/1999/xlink" width="100%" height="100%" xmlns="http://www.w3.org/2000/svg">
	<defs>
		<menu id='ContextMenu' xmlns='http://mapsContextMenu.openNMS.org' />
	</defs>
	<script type="text/ecmascript" xlink:href="js/helpers.js"/>

	<script type="text/ecmascript" xlink:href="ECMAScript/helper_functions.js"/>
	<script type="text/ecmascript" xlink:href="ECMAScript/mapApp.js"/>
	<script type="text/ecmascript" xlink:href="ECMAScript/timer.js"/>
	<script type="text/ecmascript" xlink:href="ECMAScript/textbox.js"/>
	<script type="text/ecmascript" xlink:href="ECMAScript/button.js"/>
	<script type="text/ecmascript" xlink:href="ECMAScript/selectionList.js"/>
	<script type="text/ecmascript" xlink:href="ECMAScript/Point2D.js"/>
	<script type="text/ecmascript" xlink:href="ECMAScript/PickColor.js"/>	

	<script type="text/ecmascript" xlink:href="svgjavascript/MoveableSVGElement.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ApplicationConstants.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ApplicationVariables.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ApplicationHelpers.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ApplicationEventProcessor.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/Menu.js"/>	
	<script type="text/ecmascript" xlink:href="svgjavascript/Map.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/Node.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/Label.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/Link.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/MapElement.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/Semaphore.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ElemMap.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ApplicationMap.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ApplicationMenu.js"/>
	<script type="text/ecmascript" xlink:href="svgjavascript/ContextMenu.js"/>	
	
<script type="text/ecmascript"><![CDATA[
		// ************** LOAD THE MAP APPLICATION ********************
function startUp() {
	// Instantiate the default map
	map = new Map("#"+DEFAULT_BG_COLOR, "", "Background", mapWidth, mapHeight, 0, 0);
	mapSvgElement.appendChild(map.getSvgNode());

	LoadMaps();
	LoadNodes();
		
	addLegend();

 	
 	if(isUserAdmin){
		instantiateRWNormalMenu();
	}else{
		instantiateROMenu();	
	}

	enableMenu();
	displayCountDown("Set Refresh Time",true);


	
}

function handleInit(data) {
	if(data.success || data.status==200) {
		var mapsPropertiesFactory=eval("("+data.content+")");
		isUserAdmin=mapsPropertiesFactory.userAdmin;
		reloadMap = mapsPropertiesFactory.reload;
		contextMenuEnabled = mapsPropertiesFactory.contextMenuEnabled;
		doubleClickEnabled = mapsPropertiesFactory.doubleClickEnabled;
		UNKNOWN_STATUS = mapsPropertiesFactory.unknownStatus.id;
		var i=0;
		
		for (i=0;i<mapsPropertiesFactory.contextMenu.entries.length;i++) 
		{
			CM_COMMANDS[i]=mapsPropertiesFactory.contextMenu.entries[i].command;
			CM_LINKS[i]=mapsPropertiesFactory.contextMenu.entries[i].link;
			CM_PARAMS[i]=mapsPropertiesFactory.contextMenu.entries[i].params;    				    		     
		}
		
		for (i=0;i<mapsPropertiesFactory.links.length;i++)
		{	
			var currLink = mapsPropertiesFactory.links[i];
			LINK_SPEED[currLink.id]=currLink.speed;
			LINK_TEXT[currLink.id]=currLink.text;
			LINK_WIDTH[currLink.id]=currLink.width;
			LINK_DASHARRAY[currLink.id]=currLink.dasharray;
		}
              
        for (i=0;i<mapsPropertiesFactory.linkStatuses.length;i++)
        {
            var currLinkStatus = mapsPropertiesFactory.linkStatuses[i];
            LINKSTATUS_COLOR[currLinkStatus.id]=currLinkStatus.color;
            LINKSTATUS_FLASH[currLinkStatus.id]=currLinkStatus.flash;
        }

        for (i=0;i<mapsPropertiesFactory.statuses.length;i++)
        {
            var status = mapsPropertiesFactory.statuses[i];
   			STATUSES_TEXT[status.id]=status.text;
			STATUSES_COLOR[status.id]=status.color;
        	STATUSES_UEI[status.id]=status.uei;
        }

        for (i=0;i<mapsPropertiesFactory.severities.length;i++)
        {
            var severity = mapsPropertiesFactory.severities[i];
        	SEVERITIES_LABEL[severity.id]=severity.label;
    	 	SEVERITIES_COLOR[severity.id]=severity.color;
			SEVERITIES_FLASH[severity.id]=severity.flash;
        }

        for (i=0;i<mapsPropertiesFactory.avails.length;i++)
        {
            var avail = mapsPropertiesFactory.avails[i];
            AVAIL_MIN[avail.id]=avail.min;
            AVAIL_COLOR[avail.id]=avail.color;
            AVAIL_FLASH[avail.id]=avail.flash;
		}
	
		mapElemDimension=mapsPropertiesFactory.defaultMapElementDimension;
		
		for(var icon in mapsPropertiesFactory.icons)
		{
            MEIcons.push(icon);
            MEIconsSorts.push(IMAGES_ELEMENTS_FOLDER+mapsPropertiesFactory.icons[icon]);
        }
              
		for (var image in mapsPropertiesFactory.backgroundImages)
        {
            BGImages.push(image);
            BGImagesSorts.push(IMAGES_BACKGROUND_FOLDER+mapsPropertiesFactory.backgroundImages[image]);                            
		}

        for (var dim in mapsPropertiesFactory.mapElementDimensions)
        {
			MapElemDim.push(dim+" pixel width");
			MapElemDimSorts.push(dim);                                	
		}

        for(var index in mapsPropertiesFactory.categories)
        {
			categories.push(escapeSpecialChars(mapsPropertiesFactory.categories[index]));
			categorySorts.push(escapeSpecialChars(mapsPropertiesFactory.categories[index]));
        }
        
        refreshTimeMins.push("30 seconds");
		refreshTimeMinsSorts.push(30);
		refreshTimeMins.push("1 minute");
		refreshTimeMinsSorts.push(60);
		refreshTimeMins.push("2 minutes");
		refreshTimeMinsSorts.push(120);
		refreshTimeMins.push("5 minutes");
		refreshTimeMinsSorts.push(300);
		refreshTimeMins.push("10 minutes");
		refreshTimeMinsSorts.push(600);
		refreshTimeMins.push("20 minutes");
		refreshTimeMinsSorts.push(1200);
		
		refreshTimeMinsSortAss = assArrayPopulate(refreshTimeMins,refreshTimeMinsSorts);        
               				
		DEFAULT_ICON = mapsPropertiesFactory.defaultNodeIcon;
		DEFAULT_MAP_ICON = mapsPropertiesFactory.defaultMapIcon;
		DEFAULT_BG_COLOR = mapsPropertiesFactory.defaultBackgroundColor;
		NODE_TYPE = mapsPropertiesFactory.NODE_TYPE;
		MAP_TYPE= mapsPropertiesFactory.MAP_TYPE;
		MAP_NOT_OPENED = mapsPropertiesFactory.MAP_NOT_OPENED;
		NEW_MAP = mapsPropertiesFactory.NEW_MAP;
		currentMapId = MAP_NOT_OPENED;
		currentMapBackGround = DEFAULT_BG_COLOR;
		categorySortAss = assArrayPopulate(categories,categorySorts);
    	BGImagesSortAss = assArrayPopulate(BGImages,BGImagesSorts);		
    	MapElemDimSortAss = assArrayPopulate(MapElemDim,MapElemDimSorts);	
    	MEIconsSortAss = assArrayPopulate(MEIcons,MEIconsSorts);

		mynodesResult = new nodesResult();
	    mymapsResult = new mapsResult();
	    mycategoriesResult = new categoriesResult();

	    myBGImagesResult = new BGImagesResult();
	    myMapElemDimResult = new MapElemDimResult();
	    myMEIconsResult = new MEIconsResult();
		myRefreshTimeMinsResult = new refreshTimeMinsResult();
		
		colorSemaphoreBy='S';
		
		startUp()
	}else{
		alert("Initialization failed.");
	}	
}	

function load(evt){
	
	// Reference var to the Menu SVG Object
	
	menuSvgElement = document.getElementById("Menu");
	
	// Reference var to the MapPanel SVG Object		
	mapSvgElement = document.getElementById("MapPanel");

	mapWidth=parseInt((screen.availWidth*97/100))-250;
	mapHeight=parseInt(mapWidth*3/4);			
	
	// Define the position of the work panel
	document.getElementById('WorkPanel').setAttributeNS(null,"x",mapWidth+5);

	postMapRequestAll( "MapStartUp."+suffix, "GET", null, handleInit, "text/xml", null, true );
}

]]></script>

	<svg id="MapPanel"/>

	<!-- ******** W O R K P A N E L ********* -->	
	<svg id="WorkPanel" width="211" height="600" y="0">

		<!-- ********* TOOLBAR M E N U ********* -->

		<rect x="0" y="0"    id="toolbar" width="100%" height="21px" stroke="blue" />
		<rect x="0" y="400"   id="mendbar" width="100%" height="21px" stroke="blue" fill="dimgray"/>
		<text x="5" y="403"   id="countDownText" font-family="Arial,Helvetica" fill="white"/>
		<svg id="Menu"/>


		<!-- ********* map informations ********* -->
		<text id="MapInfo" display="none" x="3" y="50" font-family="Arial,Helvetica" font-size='12'>Map info</text>	
	
		<!-- ********* maps history ********* -->
		<svg id="history" y="150" x="3" width="150" heigth="100">
		    <g id="prevGroup" display="none">
				<polygon id="prev" points="0,30 5,27 5,33" style="stroke:grey;fill:blue"/>
				<polygon id="prev" points="6,30 11,27 11,33" style="stroke:grey;fill:blue"/>
				<text id="prevMapName" x='13' y='33' font-family="Arial,Helvetica" font-size='10' style='fill:grey'></text>
				<rect  style="cursor:pointer" id="prevAction"  x="0" y="25" rx="2" ry="2" width="14" height="10" opacity="0"/>
		    </g>
		    
		    <g id="nextGroup" display="none">
				<polygon id="next" points="0,37 0,43 5,40" style="stroke:grey;fill:blue"/>
				<polygon id="next" points="6,37 6,43 11,40" style="stroke:grey;fill:blue"/>
				<text id="nextMapName" x='13' y='43' font-family="Arial,Helvetica" font-size='10' style='fill:grey'></text>
				<rect  style="cursor:pointer" id="nextAction"  x="0" y="35" rx="2" ry="2" width="14" height="10" opacity="0"/>
		    </g>	    
	    
		</svg>	


		<!-- ********* TOP I N F O ********* -->
		

    	<svg  y="200" width="200" height="200" id="TopInfo">
			<text id="TopInfoText" x="5" y="20" font-family="Arial,Helvetica"></text>
			<g id="nodes" />
			<g id="categories" />
			<g id="maps" />
			<g id="bgimages" />
			<g id="mapelemdim" />
			<g id="meicons" />
			<g id="refreshTime" />
			<g id="textboxwithcommand" />
		</svg>

		<!-- ********* DOWN I N F O ********* -->

		<svg  y="300" width="200" height="100" id="DownInfo">
			<text id="DownInfoText" x="5" y="20" font-family="Arial,Helvetica"></text>
		</svg>	


		<svg>
			<g id="LoadingText" x="40%" y="50%" display="none">
			<rect  x="40%" y="40%" fill="white" stroke="white" width="60" height="20"  />
			<text  x="40%" y="40%"><tspan font-size='12'   dx="3" dy="13" font-family="Arial,Helvetica">Loading...</tspan></text>
			</g>
		</svg>

		<svg>
			<g id="RefreshingText" x="40%" y="50%"  display="none">
				<rect  x="40%" y="40%" fill="white" stroke="white" width="75" height="20"  />
				<text  x="40%" y="40%"><tspan  font-size='12' dx="3" dy="13" font-family="Arial,Helvetica">Refreshing...</tspan></text>
			</g>
		</svg>	

<!-- svg for changing the background color of the map -->

		<svg  id="pickColor" y="230" x="20" display="none">
			<g onkeypress="pick_color_tape(evt)" >
				<g onmouseup="pick_lacher(evt)" onmousemove="pick_bouger(evt)" onmousedown="pick_choisir(evt)">
		
					<rect id="test" x="15" y="20" width="120" height="30" style="fill:#808080"/>
					<rect x="10" y="70" width="130" height="7" style="fill:red; stroke:gray"/>
					<rect x="10" y="100" width="130" height="7" style="fill:green; stroke:gray"/>
					<rect x="10" y="130" width="130" height="7" style="fill:blue; stroke:gray"/>
					<g  style="stroke:#131516;stroke-width:1;stroke-linejoin:round">
						<rect id="rouge" x="75" y="65" width="3" height="16" style="fill:gray"/>
						<rect id="vert" x="75" y="95" width="3" height="16" style="fill:gray"/>
						<rect id="bleu" x="75" y="125" width="3" height="16" style="fill:gray"/>
					</g>
				</g>
				<rect x="15" y="145" width="50" height="20" style="fill:blue;stroke:pink;stroke-width:1;fill-opacity:0.5;stroke-opacity:0.9"/>
				<text x="28" y="160" style="font-size:10pt;fill:white">OK</text>
				<rect onclick="close_pick_color(true)" x="15" y="145" width="50" height="20" style="fill:green;fill-opacity:0"/>
				<rect x="85" y="145" width="50" height="20" style="fill:blue;stroke:pink;stroke-width:1;fill-opacity:0.5;stroke-opacity:0.9"/>
				<text x="90" y="160" style="font-size:10pt;fill:white">Cancel</text>
				<rect onclick="close_pick_color(false)" x="85" y="145" width="50" height="20" style="fill:green;fill-opacity:0"/>
			</g>
		</svg>

		<svg id="legend" y="75%"  width="130" height="130"/>

 	</svg> <!-- End WorkPanel -->
</svg>


